最近做微信APP支付，在“统一下单”里加签没有问题，调用成功，但是在 “调起支付”后却提示  支付验证签名失败。

先说一下请求的参数，参数一共有七个：

prepayid（统一下单里返回的标识符），

partnerid（商户号），

appid，

package（微信要求必须有，内容是“Sign=WXPay”），

 noncestr（随机数，不适用微信返回的，是重新生成一个，注意统一下单里的参数是nonce_str），

timestamp（时间戳，十位，注意统一下单里的时间是完整的时间，这里是时间戳），

sign（签名，将上述字段重新签名，而不是用统一下单返回的sign）。



解决方案：
1. 安卓 确定包签名是否和平台设置一样
2. **_把代码生成的签名使用验签工具进行验签来确认签名方式的问题_**
3. **_商户号不正确也会导致签名错误_**
4. 注意签名方式，**_v2只支持HMAC-SHA256和MD5_**，没有传递签名类型，**_一般默认就是MD5_**，注意查看是不是 **_传递了MD5却使用的HMAC-SHA256签名方式或者是反过来的_** **_（注意，要是接口没有说明是签名类型，则默认就是MD5，使用HMAC-SHA256则会报签名错误）
5. 调起支付的前端方法尽量使用微信支付官方文档提供的方法， **_注意参数不要有空格等问题_**_**
6. 如果上面检查都没有问题，可能自己的代码有问题， **_前后端传输问题_**，比如 **_时间戳timeStamp后端没有成功传递给接口_**，导致最终传递给微信接是空的也会报错， **_这种情况建议先把参数提前生成好，然后写死在前端，建议直接重新写个简单的测试页面_**（可以避免缓存的影响）



https://pay.weixin.qq.com/wiki/tools/signverify/

## 微信支付接口签名校验工具
https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=20_1